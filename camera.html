<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>üì∑ SAM Kamera Paneli</title>

  <!-- SEO / Open Graph / Twitter Card / JSON-LD -->
  <meta name="description" content="SAM Kamera Paneli ile canlƒ± g√∂r√ºnt√ºleri izleyin ve analiz edin. G√ºvenli, hƒ±zlƒ± ve kullanƒ±cƒ± dostu ger√ßek zamanlƒ± kamera deneyimi.">
  <meta name="keywords" content="SAM, Kamera Paneli, Canlƒ± ƒ∞zleme, G√ºvenlik, Real-time Camera, G√∂r√ºnt√º Analizi">
  <meta property="og:title" content="üì∑ SAM Kamera Paneli">
  <meta property="og:description" content="SAM Kamera Paneli ile canlƒ± g√∂r√ºnt√ºleri izleyin ve analiz edin.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://sam-hypermind.onrender.com/kamera-panel">
  <meta property="og:image" content="https://sam-hypermind.onrender.com/static/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="üì∑ SAM Kamera Paneli">
  <meta name="twitter:description" content="SAM Kamera Paneli ile canlƒ± g√∂r√ºnt√ºleri izleyin ve analiz edin.">
  <meta name="twitter:image" content="https://sam-hypermind.onrender.com/static/logo.png">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "üì∑ SAM Kamera Paneli",
    "url": "https://sam-hypermind.onrender.com/kamera-panel",
    "description": "SAM Kamera Paneli ile canlƒ± g√∂r√ºnt√ºleri izleyin ve analiz edin. G√ºvenli, hƒ±zlƒ± ve kullanƒ±cƒ± dostu ger√ßek zamanlƒ± kamera deneyimi.",
    "publisher": {
      "@type": "Organization",
      "name": "SAM HyperMind",
      "logo": {
        "@type": "ImageObject",
        "url": "https://sam-hypermind.onrender.com/static/logo.png"
      }
    }
  }
  </script>
  <style>
    :root {
      --bg-color: #10151b;
      --text-color: #f0f0f0;
      --btn-bg: #1e2a38;
      --btn-hover: #32475b;
      --accent-color: #4da6ff;
    }

    body {
      background: url('/static/camera.png') no-repeat center center fixed;
      background-size: cover;
      color: var(--text-color);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      gap: 20px;
      box-sizing: border-box;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: -1;
    }

    #notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      display: none;
      z-index: 9999;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    h1 {
      color: var(--accent-color);
      font-size: 2.2em;
      margin: 10px 0;
    }

    video {
      width: 90%;
      max-width: 900px;
      aspect-ratio: 16 / 9;
      border: 2px solid var(--accent-color);
      border-radius: 12px;
      background: #000;
    }

    #controls {
      width: 90%;
      max-width: 900px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    button, select {
      background: var(--btn-bg);
      border: none;
      color: var(--text-color);
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1em;
      text-align: center;
      transition: background 0.2s ease;
    }

    button:hover, select:hover { background: var(--btn-hover); }

    #record-indicator {
      font-weight: bold;
      color: red;
      margin-top: 5px;
    }

    canvas { display: none; }

    #gallery {
      width: 90%;
      max-width: 900px;
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      gap: 10px;
      margin-top: 20px;
    }

    .preview-item {
      border: 2px solid var(--accent-color);
      border-radius: 8px;
      width: 150px;
      height: 100px;
      overflow: hidden;
      cursor: pointer;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-item img, .preview-item video {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }

    #modal {
      display: none;
      position: fixed;
      top:0; left:0;
      width: 100%; height:100%;
      background: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #modal img, #modal video {
      max-width: 90%;
      max-height: 90%;
      border: 3px solid var(--accent-color);
      border-radius: 12px;
    }

    #modal-close {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 30px;
      color: red;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="notification"></div>

<h1>üì∑ SAM Kamera Paneli</h1>
<video id="video" autoplay playsinline></video>

<div id="controls">
  <button id="btn-toggle">üé¨ Kamera A√ß</button>
  <button id="btn-photo">üì∏ Fotoƒüraf √áek</button>
  <button id="btn-record">‚è∫Ô∏è Kayƒ±t Ba≈ülat</button>
  <button id="btn-stop">üõë Kamerayƒ± Kapat</button>
  <button id="btn-flash">üî¶ Fener</button>
  <button id="btn-fullscreen">üì∫ Tam Ekran</button>
  <button id="btn-clear">üóëÔ∏è Galeriyi Temizle</button>
  <button id="btn-analyze">ü§ñ SAM G√∂rs√ºn ve S√∂ylesin</button>
  <select id="camera-select"></select>
</div>

<div id="record-indicator"></div>
<canvas id="canvas"></canvas>
<div id="gallery"></div>

<div id="modal">
  <span id="modal-close">‚úñ</span>
</div>

<script>
const notification = document.getElementById('notification');
function showNotification(msg, duration = 3000) {
  notification.textContent = msg;
  notification.style.display = "block";
  setTimeout(() => notification.style.display = "none", duration);
}

let video = document.getElementById('video');
let canvas = document.getElementById('canvas');
let cameraSelect = document.getElementById('camera-select');
let btnToggle = document.getElementById('btn-toggle');
let btnPhoto = document.getElementById('btn-photo');
let btnRecord = document.getElementById('btn-record');
let btnStop = document.getElementById('btn-stop');
let btnFlash = document.getElementById('btn-flash');
let btnFullscreen = document.getElementById('btn-fullscreen');
let btnClear = document.getElementById('btn-clear');
let btnAnalyze = document.getElementById('btn-analyze');
let recordIndicator = document.getElementById('record-indicator');
let gallery = document.getElementById('gallery');
let modal = document.getElementById('modal');

let stream = null;
let mediaRecorder = null;
let recordedChunks = [];
let recording = false;

// Kameralarƒ± listele
async function listCameras() {
  const devices = await navigator.mediaDevices.enumerateDevices();
  const videoDevices = devices.filter(d => d.kind === 'videoinput');
  cameraSelect.innerHTML = '';
  videoDevices.forEach((device,index) => {
    const option = document.createElement('option');
    option.value = device.deviceId;
    option.text = device.label || `Kamera ${index+1}`;
    cameraSelect.appendChild(option);
  });
}

// Kamera ba≈ülat
async function startCamera(deviceId=null){
  stopCamera();
  try{
    stream = await navigator.mediaDevices.getUserMedia({ video: deviceId ? {deviceId:{exact:deviceId}} : true, audio:false });
    video.srcObject = stream;
    video.onloadedmetadata = () => {
      video.play();
      btnToggle.textContent = 'üé¨ Kamera A√ßƒ±k';
      showNotification("Kamera ba≈ülatƒ±ldƒ± ‚úÖ");
    };
  }catch(err){ showNotification('Kamera ba≈ülatƒ±lamadƒ±: '+err.message); }
}

// Kamera durdur
function stopCamera(){
  if(stream){
    stream.getTracks().forEach(track=>track.stop());
    stream=null;
    recording=false;
    recordIndicator.textContent='';
    btnToggle.textContent='üé¨ Kamera A√ß';
    btnRecord.textContent='‚è∫Ô∏è Kayƒ±t Ba≈ülat';
    showNotification("Kamera kapatƒ±ldƒ± üõë");
  }
}

// Fotoƒüraf √ßek
function takePhoto(){
  if(!stream) return showNotification('üì∑ Kamera a√ßƒ±k deƒüil!');
  if(video.videoWidth===0 || video.videoHeight===0) return showNotification('Video hen√ºz hazƒ±r deƒüil');

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const imgData = canvas.toDataURL('image/png');

  const item = document.createElement('div');
  item.className = 'preview-item';
  const img = document.createElement('img');
  img.src = imgData;
  item.appendChild(img);
  gallery.prepend(item);
  item.onclick = () => showModal(imgData, 'image');

  const a = document.createElement('a');
  a.href = imgData;
  a.download = 'sam_photo.png';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  showNotification("üì∏ Fotoƒüraf √ßekildi");
}

// Video kaydƒ± toggle
function toggleRecording() {
  if(!stream) return showNotification('üìπ Kamera a√ßƒ±k deƒüil!');
  if(recording){
    mediaRecorder.stop();
    recording=false;
    btnRecord.textContent='‚è∫Ô∏è Kayƒ±t Ba≈ülat';
    recordIndicator.textContent='';
    showNotification("Kayƒ±t durduruldu ‚èπÔ∏è");
  } else {
    recordedChunks=[];
    mediaRecorder = new MediaRecorder(stream,{ mimeType:'video/webm; codecs=vp9' });
    mediaRecorder.ondataavailable = e => { if(e.data.size>0) recordedChunks.push(e.data); };
    mediaRecorder.onstop = ()=> {
      const blob = new Blob(recordedChunks,{ type:'video/webm' });
      const url = URL.createObjectURL(blob);

      const item=document.createElement('div');
      item.className='preview-item';
      const vid=document.createElement('video');
      vid.src=url; vid.controls=true;
      item.appendChild(vid);
      gallery.prepend(item);
      item.onclick = ()=>showModal(url,'video');

      const a=document.createElement('a');
      a.href=url;
      a.download='sam_record.webm';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    };
    mediaRecorder.start();
    recording=true;
    btnRecord.textContent='‚èπÔ∏è Kayƒ±t Durdur';
    recordIndicator.textContent='üî¥ Kayƒ±t Devam Ediyor...';
    showNotification("Kayƒ±t ba≈üladƒ± üî¥");
  }
}

// Flash toggle
async function toggleFlash(){
  if(!stream) return showNotification("üìπ Kamera a√ßƒ±k deƒüil!");
  try{
    let track = stream.getVideoTracks()[0];
    let caps = track.getCapabilities();
    if(!caps.torch) return showNotification("Fener desteklenmiyor");
    let settings = track.getSettings();
    await track.applyConstraints({advanced:[{torch:!settings.torch}]}).then(()=>{ showNotification("Fener durumu deƒüi≈ütirildi üî¶"); });
  }catch(err){ showNotification("Fener hatasƒ±: "+err.message); }
}

// Modal g√∂ster
function showModal(src,type){
  modal.innerHTML = '';
  const close = document.createElement('span');
  close.id='modal-close'; close.textContent='‚úñ';
  close.onclick = ()=>{ modal.style.display='none'; };
  modal.appendChild(close);

  if(type==='image'){
    const img = document.createElement('img');
    img.src=src;
    modal.appendChild(img);
  } else if(type==='video'){
    const vid = document.createElement('video');
    vid.src=src;
    vid.controls=true;
    vid.autoplay=true;
    modal.appendChild(vid);
  }
  modal.style.display='flex';
}

// SAM analiz
async function analyzeFrame(){
  if(!stream) return showNotification("üìπ Kamera a√ßƒ±k deƒüil!");
  if(video.videoWidth===0 || video.videoHeight===0) return showNotification("Video hen√ºz hazƒ±r deƒüil");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video,0,0,canvas.width,canvas.height);
  const imageData = canvas.toDataURL('image/png');

  try {
    const res = await fetch('/analyze-camera-frame', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({image: imageData})
    });
    const data = await res.json();
    speakText(data.message);
    showNotification("ü§ñ SAM dedi ki: " + data.message, 5000);
  } catch(err){
    showNotification("Hata: "+err.message);
  }
}

// Konu≈üma
function speakText(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "tr-TR";
  utterance.rate = 0.95;
  utterance.pitch = 1.1;

  const voices = speechSynthesis.getVoices();
  const turkish = voices.find(v => v.lang.startsWith("tr"));
  if (turkish) utterance.voice = turkish;

  speechSynthesis.cancel();
  speechSynthesis.speak(utterance);
}

// Event listener
btnToggle.addEventListener('click',()=>{ stream?stopCamera():startCamera(cameraSelect.value); });
btnStop.addEventListener('click', stopCamera);
btnPhoto.addEventListener('click', takePhoto);
btnRecord.addEventListener('click', toggleRecording);
btnFlash.addEventListener('click', toggleFlash);
btnFullscreen.addEventListener('click',()=>{ video.requestFullscreen?.(); });
btnClear.addEventListener('click',()=>{ gallery.innerHTML=''; showNotification("Galeri temizlendi üóëÔ∏è"); });
btnAnalyze.addEventListener('click', analyzeFrame);
cameraSelect.addEventListener('change',()=>{ startCamera(cameraSelect.value); });

listCameras();
</script>

<script>
function samSpeak(text) {
  const sentences = text.match(/[^.!?]+[.!?]+/g) || [text]; // Noktalara g√∂re b√∂l
  let index = 0;

  function speakNext() {
    if (index < sentences.length) {
      const utterance = new SpeechSynthesisUtterance(sentences[index].trim());
      utterance.lang = "tr-TR";
      utterance.rate = 0.95;
      utterance.pitch = 1.1;
      utterance.onend = () => {
        index++;
        speakNext(); // sƒ±radaki c√ºmleyi oku
      };
      speechSynthesis.speak(utterance);
    }
  }

  speechSynthesis.cancel();
  speakNext();
}
</script>


</body>
</html>
